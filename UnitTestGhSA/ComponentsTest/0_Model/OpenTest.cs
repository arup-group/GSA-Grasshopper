using System;
using NUnit.Framework;
using GhSA;
using GhSA.Parameters;
using Rhino.Geometry;
using Rhino;
using Grasshopper;
using GsaAPI;

namespace ComponentsTest
{
    public class ModelTests
    {
        [TestCase]
        public void OpenComponentTest()
        {
            // create the component
            var comp = new GhSA.Components.OpenModel();

            // set filename to be openend
            string file = GhSA.Util.Gsa.GsaPath.GetPath + "\\Samples\\Steel\\Steel_Design_Simple.gwb";
            // convert to GH_String
            Grasshopper.Kernel.Types.GH_String ghFile = null;
            Grasshopper.Kernel.GH_Convert.ToGHString(file, Grasshopper.Kernel.GH_Conversion.Both, ref ghFile);

            // set input data
            comp.Params.Input[0] = ghFile as Grasshopper.Kernel.IGH_Param; //as Grasshopper.Kernel.Parameters.Param_GenericObject;
            //input = ghFile; //as Grasshopper.Kernel.Parameters.Param_GenericObject;

            // run component calculation
            comp.ExpireSolution(true);

            // read output data
            var model = comp.Params.Output[0];
            GsaModelGoo gooModel = (GsaModelGoo)model;
            Assert.IsNotNull(gooModel);
        }
        [TestCase]
        public void EditNodeComponentTest()
        {
            // create the component
            var comp = new GhSA.Components.CreateOffset();
            comp.CreateAttributes();

            // set input data
            //comp.Params.Input[0] = 
            
            // run component calculation
            comp.ExpireSolution(true);

            // read output data
            comp.Params.Output[0].CollectData();
            GsaOffsetGoo output = (GsaOffsetGoo)comp.Params.Output[0].VolatileData.get_Branch(0)[0];

            GsaOffset offset = new GsaOffset();
            output.CastTo(ref offset);

            Assert.AreEqual(0, offset.X1);
        }
    }
}